#!/bin/sh

set -e

PATH=$PATH:/opt/likewise/bin
export PATH

case "$1" in
    abort-upgrade)
    ;;

    configure)
    domainjoin-cli configure --enable pam
    domainjoin-cli configure --enable nsswitch

    if [ -z "`pidof lwsmd`" ]; then 
        /etc/init.d/lwsmd start
    else
        lwsm stop lwreg || true
        /etc/init.d/lwsmd restart
    fi

    for file in /etc/likewise/*reg; do
	echo "Importing $file..."
        lwregshell upgrade $file > /dev/null
    done
    /etc/init.d/lwsmd reload
    lwsm stop lwreg
    lwsm start srvsvc
    ;;
esac

#DEBHELPER#
