SUBDIRS="libdomainjoin domainjoin-cli domainjoin-gui"

option()
{
    mk_option \
        OPTION=dj-gui \
        PARAM='yes|no' \
        VAR=DJ_GUI \
        DEFAULT="yes" \
        HELP="Build domainjoin GUI"
}

configure()
{
    mk_config_header "include/DomainJoinConfig.h"
    
    lw_define_feature_macros

    MK_CFLAGS="$MK_CFLAGS -Wall -Werror"
    
    mk_define LOCALSTATEDIR "\"$MK_LOCALSTATEDIR\""
    mk_define BINDIR "\"$MK_BINDIR\""
    mk_define SBINDIR "\"$MK_SBINDIR\""
    mk_define LIBDIR "\"$MK_LIBDIR\""
    mk_define PREFIXDIR "\"$MK_PREFIX\""
    mk_define DATADIR "\"$MK_DATADIR\""

    if [ "$DJ_GUI" = yes ] && mk_pkg_config \
	VARPREFIX=GTK \
	glib-2.0 gthread-2.0 gtk+-2.0 libglade-2.0
    then
	mk_msg "GTK+ interface enabled"
        DJ_GUI_ENABLED=yes
    else
	mk_msg "GTK+ interface disabled"
	mk_skip_subdir domainjoin-gui
        DJ_GUI_ENABLED=no
    fi
    
    mk_check_functions \
        HEADERDEPS="gtk/gtk.h" \
        CPPFLAGS="$GTK_CPPFLAGS" \
        CFLAGS="$GTK_CFLAGS" \
        LDFLAGS="$GTK_LDFLAGS" \
        LIBDEPS="$GTK_LIBS" \
        gtk_file_chooser_dialog_new

    mk_export DJ_GUI_ENABLED

    mk_check_headers \
	signal.h

    mk_check_functions \
	HEADERDEPS="signal.h" \
	sigprocmask

    mk_check_functions \
	HEADERDEPS="ctype.h" \
        isblank

    mk_check_functions \
	HEADERDEPS="stdlib.h" \
	strtol strtoll strtoul strtoull
}